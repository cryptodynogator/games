<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoNews Pro | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #000000;
            --accent: #f7a600;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f0f0f;
            color: #f5f5f5;
        }
        
        .btn-primary {
            background-color: var(--accent);
            color: var(--primary);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background-color: #e69500;
            transform: translateY(-2px);
        }
        
        .card {
            background-color: rgba(30, 30, 30, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: #1a1a1a;
            border-radius: 12px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .news-card {
            transition: transform 0.3s ease;
        }
        
        .news-card:hover {
            transform: translateY(-5px);
        }
        
        .reward-progress {
            height: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--accent);
            border-radius: 4px;
        }
        
        .error-message {
            color: #f87171;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        
        .success-message {
            color: #34d399;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Navigation -->
    <nav class="bg-black py-4 px-6 flex justify-between items-center border-b border-gray-800">
        <div class="flex items-center">
            <i class="fab fa-bitcoin text-2xl mr-2" style="color: var(--accent);"></i>
            <span class="text-xl font-bold">CryptoNews Pro</span>
        </div>
        <div class="flex items-center space-x-4">
            <button id="loginBtn" class="btn-primary px-4 py-2 rounded-lg font-semibold">Login</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Hero Section -->
        <section class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold mb-4">Premium Crypto Insights & Analytics</h1>
            <p class="text-xl text-gray-300 max-w-2xl mx-auto mb-8">Get exclusive market analysis, trading signals, and the latest crypto news delivered to your dashboard.</p>
            <button id="ctaBtn" class="btn-primary px-6 py-3 rounded-lg font-bold text-lg">Get Started</button>
        </section>

        <!-- Features Section -->
        <section class="mb-16">
            <h2 class="text-3xl font-bold text-center mb-10">Why Choose CryptoNews Pro?</h2>
            <div class="dashboard-grid">
                <div class="card p-6 rounded-xl">
                    <div class="w-12 h-12 rounded-full flex items-center justify-center mb-4" style="background-color: rgba(247, 166, 0, 0.2);">
                        <i class="fas fa-chart-line text-xl" style="color: var(--accent);"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Real-time Analytics</h3>
                    <p class="text-gray-400">Access live market data, price charts, and trading indicators to make informed decisions.</p>
                </div>
                
                <div class="card p-6 rounded-xl">
                    <div class="w-12 h-12 rounded-full flex items-center justify-center mb-4" style="background-color: rgba(247, 166, 0, 0.2);">
                        <i class="fas fa-newspaper text-xl" style="color: var(--accent);"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Exclusive News</h3>
                    <p class="text-gray-400">Get breaking crypto news and analysis from our team of experts before it hits mainstream media.</p>
                </div>
                
                <div class="card p-6 rounded-xl">
                    <div class="w-12 h-12 rounded-full flex items-center justify-center mb-4" style="background-color: rgba(247, 166, 0, 0.2);">
                        <i class="fas fa-gift text-xl" style="color: var(--accent);"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Bybit Rewards</h3>
                    <p class="text-gray-400">New users can earn up to $30,100 in bonuses when they deposit and trade on Bybit.</p>
                </div>
            </div>
        </section>

        <!-- Rewards Section -->
        <section class="mb-16">
            <div class="card p-8 rounded-xl">
                <h2 class="text-3xl font-bold mb-6 text-center">Unlock Exclusive Bybit Rewards</h2>
                <div class="max-w-3xl mx-auto">
                    <p class="text-lg text-center mb-8">Hook your users up with the best deposit rewards on the market! Your users will earn up to $30,100 when they make their first deposit and trade on Bybit.</p>
                    
                    <div class="bg-gray-900 p-6 rounded-lg mb-8">
                        <h3 class="text-xl font-bold mb-4" style="color: var(--accent);">How can users get started?</h3>
                        <ol class="list-decimal pl-5 space-y-3">
                            <li class="text-lg">Sign up as a new user</li>
                            <li class="text-lg">Fulfill the deposit and trading criteria to unlock bonuses within 14 days</li>
                            <li class="text-lg">Claim their bonuses in our Rewards Hub!</li>
                        </ol>
                    </div>
                    
                    <div class="text-center">
                        <a href="https://partner.bybit.com/b/35978" target="_blank" class="btn-primary px-6 py-3 rounded-lg font-bold text-lg inline-block">Sign Up on Bybit</a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-black py-8 border-t border-gray-800">
        <div class="container mx-auto px-4 text-center text-gray-400">
            <p>&copy; 2023 CryptoNews Pro. All rights reserved.</p>
            <p class="mt-2">This site is not affiliated with Bybit. Bybit is a registered trademark.</p>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Access Your Dashboard</h2>
                <button id="closeModal" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div id="loginOptions" class="space-y-4">
                <p class="text-gray-300 mb-4">Please select your account type:</p>
                
                <button id="newAccountBtn" class="w-full card p-4 rounded-lg text-left hover:bg-gray-800 transition-colors">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center mr-4" style="background-color: rgba(247, 166, 0, 0.2);">
                            <i class="fas fa-user-plus" style="color: var(--accent);"></i>
                        </div>
                        <div>
                            <h3 class="font-bold">Create New Account</h3>
                            <p class="text-sm text-gray-400">I don't have a Bybit ID yet</p>
                        </div>
                    </div>
                </button>
                
                <button id="existingAccountBtn" class="w-full card p-4 rounded-lg text-left hover:bg-gray-800 transition-colors">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center mr-4" style="background-color: rgba(247, 166, 0, 0.2);">
                            <i class="fas fa-key" style="color: var(--accent);"></i>
                        </div>
                        <div>
                            <h3 class="font-bold">I Have Bybit ID</h3>
                            <p class="text-sm text-gray-400">Sign in with your existing Bybit account</p>
                        </div>
                    </div>
                </button>
            </div>
            
            <!-- Login Form -->
            <form id="loginForm" class="hidden">
                <div id="loginMessage" class="mb-4"></div>
                
                <div class="mb-4">
                    <label for="bybitId" class="block text-gray-300 mb-2">Bybit ID</label>
                    <input type="text" id="bybitId" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-yellow-500" placeholder="Enter your Bybit ID">
                </div>
                
                <div class="mb-6">
                    <label for="password" class="block text-gray-300 mb-2">Password</label>
                    <input type="password" id="password" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-yellow-500" placeholder="Enter your password">
                </div>
                
                <button type="submit" class="w-full btn-primary py-3 rounded-lg font-bold flex items-center justify-center">
                    <span id="loginBtnText">Access Dashboard</span>
                    <div id="loginSpinner" class="loading ml-2 hidden"></div>
                </button>
                
                <p class="text-center mt-4 text-gray-400">
                    Don't have an account? 
                    <button type="button" id="showRegisterForm" class="text-yellow-500 hover:underline">Register here</button>
                </p>
            </form>
            
            <!-- Registration Form -->
            <form id="registerForm" class="hidden">
                <div id="registerMessage" class="mb-4"></div>
                
                <div class="mb-4">
                    <label for="regBybitId" class="block text-gray-300 mb-2">Bybit ID</label>
                    <input type="text" id="regBybitId" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-yellow-500" placeholder="Enter your Bybit ID">
                </div>
                
                <div class="mb-4">
                    <label for="email" class="block text-gray-300 mb-2">Email</label>
                    <input type="email" id="email" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-yellow-500" placeholder="Enter your email">
                </div>
                
                <div class="mb-6">
                    <label for="regPassword" class="block text-gray-300 mb-2">Password</label>
                    <input type="password" id="regPassword" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-yellow-500" placeholder="Create a password (min. 6 characters)">
                </div>
                
                <button type="submit" class="w-full btn-primary py-3 rounded-lg font-bold flex items-center justify-center">
                    <span id="registerBtnText">Create Account</span>
                    <div id="registerSpinner" class="loading ml-2 hidden"></div>
                </button>
                
                <p class="text-center mt-4 text-gray-400">
                    Already have an account? 
                    <button type="button" id="showLoginForm" class="text-yellow-500 hover:underline">Sign in here</button>
                </p>
            </form>
        </div>
    </div>

    <!-- Dashboard (Hidden by default) -->
    <div id="dashboard" class="hidden">
        <!-- Dashboard Header -->
        <div class="bg-black py-4 px-6 flex justify-between items-center border-b border-gray-800">
            <div class="flex items-center">
                <i class="fab fa-bitcoin text-2xl mr-2" style="color: var(--accent);"></i>
                <span class="text-xl font-bold">CryptoNews Pro</span>
            </div>
            <div class="flex items-center space-x-4">
                <span id="userWelcome" class="text-gray-300">Welcome, User!</span>
                <button id="logoutBtn" class="btn-primary px-4 py-2 rounded-lg font-semibold">Logout</button>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div class="container mx-auto px-4 py-8">
            <h1 class="text-3xl font-bold mb-8">Your Dashboard</h1>
            
            <!-- Stats Cards -->
            <div class="dashboard-grid mb-8">
                <div class="card p-6 rounded-xl">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold">Portfolio Value</h3>
                        <i class="fas fa-wallet text-xl" style="color: var(--accent);"></i>
                    </div>
                    <p class="text-2xl font-bold">$12,458.32</p>
                    <p class="text-green-500 text-sm mt-2"><i class="fas fa-arrow-up mr-1"></i> +2.4% today</p>
                </div>
                
                <div class="card p-6 rounded-xl">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold">Rewards Progress</h3>
                        <i class="fas fa-gift text-xl" style="color: var(--accent);"></i>
                    </div>
                    <p class="text-lg font-bold mb-2">$5,250 / $30,100</p>
                    <div class="reward-progress">
                        <div class="progress-bar" style="width: 17%"></div>
                    </div>
                    <p class="text-gray-400 text-sm mt-2">Complete more trades to unlock rewards</p>
                </div>
                
                <div class="card p-6 rounded-xl">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold">Market Sentiment</h3>
                        <i class="fas fa-chart-pie text-xl" style="color: var(--accent);"></i>
                    </div>
                    <p class="text-2xl font-bold">Bullish</p>
                    <p class="text-gray-400 text-sm mt-2">Based on last 24h trading data</p>
                </div>
            </div>
            
            <!-- News Section -->
            <div class="mb-8">
                <h2 class="text-2xl font-bold mb-6">Latest Crypto News</h2>
                <div class="dashboard-grid">
                    <div class="card p-6 rounded-xl news-card">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold mr-3">B</div>
                            <div>
                                <h3 class="font-bold">Bitcoin Breaks $45K</h3>
                                <p class="text-gray-400 text-sm">2 hours ago</p>
                            </div>
                        </div>
                        <p class="text-gray-300">Bitcoin surged past $45,000 for the first time in months as institutional interest grows.</p>
                        <button class="mt-4 text-yellow-500 font-semibold flex items-center">
                            Read More <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                    
                    <div class="card p-6 rounded-xl news-card">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 rounded-full bg-purple-500 flex items-center justify-center text-white font-bold mr-3">E</div>
                            <div>
                                <h3 class="font-bold">Ethereum Upgrade</h3>
                                <p class="text-gray-400 text-sm">5 hours ago</p>
                            </div>
                        </div>
                        <p class="text-gray-300">The upcoming Ethereum upgrade promises to reduce gas fees and improve scalability.</p>
                        <button class="mt-4 text-yellow-500 font-semibold flex items-center">
                            Read More <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                    
                    <div class="card p-6 rounded-xl news-card">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 rounded-full bg-green-500 flex items-center justify-center text-white font-bold mr-3">D</div>
                            <div>
                                <h3 class="font-bold">DeFi Trends 2023</h3>
                                <p class="text-gray-400 text-sm">1 day ago</p>
                            </div>
                        </div>
                        <p class="text-gray-300">Decentralized finance continues to evolve with new protocols and yield farming opportunities.</p>
                        <button class="mt-4 text-yellow-500 font-semibold flex items-center">
                            Read More <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Trading Pairs -->
            <div>
                <h2 class="text-2xl font-bold mb-6">Top Trading Pairs</h2>
                <div class="card p-6 rounded-xl overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-700">
                                <th class="text-left py-3">Pair</th>
                                <th class="text-left py-3">Price</th>
                                <th class="text-left py-3">24h Change</th>
                                <th class="text-left py-3">Volume</th>
                                <th class="text-left py-3">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b border-gray-800">
                                <td class="py-4 font-bold">BTC/USDT</td>
                                <td class="py-4">$45,210.50</td>
                                <td class="py-4 text-green-500">+2.34%</td>
                                <td class="py-4">$18.2B</td>
                                <td class="py-4">
                                    <button class="btn-primary px-3 py-1 rounded text-sm font-semibold">Trade</button>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-800">
                                <td class="py-4 font-bold">ETH/USDT</td>
                                <td class="py-4">$3,210.75</td>
                                <td class="py-4 text-green-500">+1.56%</td>
                                <td class="py-4">$9.8B</td>
                                <td class="py-4">
                                    <button class="btn-primary px-3 py-1 rounded text-sm font-semibold">Trade</button>
                                </td>
                            </tr>
                            <tr class="border-b border-gray-800">
                                <td class="py-4 font-bold">SOL/USDT</td>
                                <td class="py-4">$102.40</td>
                                <td class="py-4 text-red-500">-0.87%</td>
                                <td class="py-4">$2.1B</td>
                                <td class="py-4">
                                    <button class="btn-primary px-3 py-1 rounded text-sm font-semibold">Trade</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Supabase
        const SUPABASE_URL = 'https://rdjupkwgtrwjjysvcbcr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJkanVwa3dndHJ3amp5c3ZjYmNyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1NzU0MDUsImV4cCI6MjA3ODE1MTQwNX0.M627Yq2I_NATE9VlfiIT8ww8xh7bMUTesaZ6Vx2tZCw';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // DOM Elements
        const loginBtn = document.getElementById('loginBtn');
        const ctaBtn = document.getElementById('ctaBtn');
        const closeModal = document.getElementById('closeModal');
        const loginModal = document.getElementById('loginModal');
        const newAccountBtn = document.getElementById('newAccountBtn');
        const existingAccountBtn = document.getElementById('existingAccountBtn');
        const loginOptions = document.getElementById('loginOptions');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const showLoginForm = document.getElementById('showLoginForm');
        const showRegisterForm = document.getElementById('showRegisterForm');
        const dashboard = document.getElementById('dashboard');
        const logoutBtn = document.getElementById('logoutBtn');
        const userWelcome = document.getElementById('userWelcome');
        const loginMessage = document.getElementById('loginMessage');
        const registerMessage = document.getElementById('registerMessage');
        const loginSpinner = document.getElementById('loginSpinner');
        const registerSpinner = document.getElementById('registerSpinner');
        const loginBtnText = document.getElementById('loginBtnText');
        const registerBtnText = document.getElementById('registerBtnText');
        
        // Show login modal
        function showLoginModal() {
            loginModal.classList.remove('hidden');
            loginOptions.classList.remove('hidden');
            loginForm.classList.add('hidden');
            registerForm.classList.add('hidden');
            clearMessage(loginMessage);
            clearMessage(registerMessage);
        }
        
        // Hide login modal
        function hideLoginModal() {
            loginModal.classList.add('hidden');
        }
        
        // Show dashboard
        function showDashboard() {
            document.querySelector('main').classList.add('hidden');
            document.querySelector('footer').classList.add('hidden');
            document.querySelector('nav').classList.add('hidden');
            dashboard.classList.remove('hidden');
        }
        
        // Hide dashboard
        function hideDashboard() {
            dashboard.classList.add('hidden');
            document.querySelector('main').classList.remove('hidden');
            document.querySelector('footer').classList.remove('hidden');
            document.querySelector('nav').classList.remove('hidden');
        }
        
        // Display message in forms
        function displayMessage(element, message, type) {
            element.innerHTML = `<div class="${type}-message">${message}</div>`;
        }
        
        // Clear message
        function clearMessage(element) {
            element.innerHTML = '';
        }
        
        // Show loading state
        function setLoading(button, spinner, text, isLoading) {
            if (isLoading) {
                spinner.classList.remove('hidden');
                text.textContent = 'Processing...';
                button.disabled = true;
            } else {
                spinner.classList.add('hidden');
                text.textContent = text === loginBtnText ? 'Access Dashboard' : 'Create Account';
                button.disabled = false;
            }
        }
        
        // Event Listeners
        loginBtn.addEventListener('click', showLoginModal);
        ctaBtn.addEventListener('click', showLoginModal);
        closeModal.addEventListener('click', hideLoginModal);
        
        // New account - redirect to Bybit
        newAccountBtn.addEventListener('click', function() {
            window.open('https://partner.bybit.com/b/35978', '_blank');
        });
        
        // Existing account - show login form
        existingAccountBtn.addEventListener('click', function() {
            loginOptions.classList.add('hidden');
            loginForm.classList.remove('hidden');
            clearMessage(loginMessage);
        });
        
        // Switch to login form
        showLoginForm.addEventListener('click', function() {
            registerForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
            clearMessage(loginMessage);
        });
        
        // Switch to register form
        showRegisterForm.addEventListener('click', function() {
            loginForm.classList.add('hidden');
            registerForm.classList.remove('hidden');
            clearMessage(registerMessage);
        });
        
        // Login form submission
        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const bybitId = document.getElementById('bybitId').value;
            const password = document.getElementById('password').value;
            
            if (!bybitId || !password) {
                displayMessage(loginMessage, 'Please enter both Bybit ID and password', 'error');
                return;
            }
            
            setLoading(loginForm.querySelector('button'), loginSpinner, loginBtnText, true);
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: bybitId + '@cryptonews.com', // Using Bybit ID as part of email
                    password: password
                });
                
                if (error) {
                    displayMessage(loginMessage, 'Invalid credentials. Please try again.', 'error');
                } else {
                    // Store user data
                    const { data: userData, error: userError } = await supabase
                        .from('users')
                        .select('bybit_id')
                        .eq('id', data.user.id)
                        .single();
                    
                    if (!userError && userData) {
                        userWelcome.textContent = `Welcome, ${userData.bybit_id}!`;
                    } else {
                        userWelcome.textContent = `Welcome, ${bybitId}!`;
                    }
                    
                    hideLoginModal();
                    showDashboard();
                }
            } catch (error) {
                console.error('Login error:', error);
                displayMessage(loginMessage, 'Network error. Please try again.', 'error');
            } finally {
                setLoading(loginForm.querySelector('button'), loginSpinner, loginBtnText, false);
            }
        });
        
        // Registration form submission
        registerForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const bybitId = document.getElementById('regBybitId').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('regPassword').value;
            
            if (!bybitId || !email || !password) {
                displayMessage(registerMessage, 'Please fill in all fields', 'error');
                return;
            }
            
            if (password.length < 6) {
                displayMessage(registerMessage, 'Password must be at least 6 characters', 'error');
                return;
            }
            
            setLoading(registerForm.querySelector('button'), registerSpinner, registerBtnText, true);
            
            try {
                // First, create the auth user
                const { data: authData, error: authError } = await supabase.auth.signUp({
                    email: email,
                    password: password,
                });
                
                if (authError) {
                    if (authError.message.includes('already registered')) {
                        displayMessage(registerMessage, 'Email already registered. Please use a different email.', 'error');
                    } else {
                        displayMessage(registerMessage, 'Registration failed: ' + authError.message, 'error');
                    }
                    return;
                }
                
                // Then, store additional user data in the users table
                const { data: userData, error: userError } = await supabase
                    .from('users')
                    .insert([
                        { 
                            id: authData.user.id,
                            bybit_id: bybitId,
                            email: email
                        }
                    ])
                    .select();
                
                if (userError) {
                    console.error('User data insertion error:', userError);
                    displayMessage(registerMessage, 'Registration completed but there was an error saving your profile.', 'error');
                } else {
                    displayMessage(registerMessage, 'Registration successful! Please check your email to verify your account.', 'success');
                    
                    // Switch to login form after successful registration
                    setTimeout(() => {
                        registerForm.classList.add('hidden');
                        loginForm.classList.remove('hidden');
                        clearMessage(loginMessage);
                    }, 3000);
                }
            } catch (error) {
                console.error('Registration error:', error);
                displayMessage(registerMessage, 'Network error. Please try again.', 'error');
            } finally {
                setLoading(registerForm.querySelector('button'), registerSpinner, registerBtnText, false);
            }
        });
        
        // Logout
        logoutBtn.addEventListener('click', async function() {
            await supabase.auth.signOut();
            hideDashboard();
        });
        
        // Check if user is already logged in
        window.addEventListener('DOMContentLoaded', async function() {
            const { data: { session } } = await supabase.auth.getSession();
            
            if (session) {
                // Get user data
                const { data: userData, error } = await supabase
                    .from('users')
                    .select('bybit_id')
                    .eq('id', session.user.id)
                    .single();
                
                if (!error && userData) {
                    userWelcome.textContent = `Welcome, ${userData.bybit_id}!`;
                } else {
                    userWelcome.textContent = `Welcome!`;
                }
                
                showDashboard();
            }
        });
        
        // Close modal when clicking outside
        loginModal.addEventListener('click', function(e) {
            if (e.target === loginModal) {
                hideLoginModal();
            }
        });
        
        // Listen to auth state changes
        supabase.auth.onAuthStateChange(async (event, session) => {
            if (event === 'SIGNED_OUT') {
                hideDashboard();
            }
        });
    </script>
</body>
</html>
